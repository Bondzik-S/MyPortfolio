{"ast":null,"code":"import{Component}from'react';import Spinner from'../spiner/spiner';import ErrorMessage from'../errorMessage/errorMessage';import MarvelService from'../../services/MarvelService';import'./charList.scss';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";class CharList extends Component{constructor(){super(...arguments);this.state={charList:[],loading:true,error:false,newItemLoading:false,offset:260,charEnded:false};this.marvelService=new MarvelService();this.onRequest=offset=>{this.onCharListLoading();this.marvelService.getAllCharacters(offset).then(this.onCharListLoaded).catch(this.onError);};this.onCharListLoading=()=>{this.setState({newItemLoading:true});};this.onCharListLoaded=newcharList=>{let ended=false;if(newcharList.length<9){ended=true;}this.setState(_ref=>{let{offset,charList}=_ref;return{charList:[...charList,...newcharList],loading:false,newItemLoading:false,offset:offset+9,charEnded:ended};});};this.onError=()=>{this.setState({error:true,loading:false});};this.itemRefs=[];this.setRef=ref=>{this.itemRefs.push(ref);};this.focusOnItem=id=>{this.itemRefs.forEach(item=>item.classList.remove('char__item_selected'));this.itemRefs[id].classList.add('char__item_selected');this.itemRefs[id].focus();};}componentDidMount(){this.onRequest();}renderItems(arr){const items=arr.map((item,i)=>{let imgStyle={'objectFit':'cover'};if(item.thumbnail==='http://i.annihil.us/u/prod/marvel/i/mg/b/40/image_not_available.jpg'){imgStyle={'objectFit':'unset'};}return/*#__PURE__*/_jsxs(\"li\",{className:\"char__item\",tabIndex:0,ref:this.setRef,onClick:()=>{this.props.onCharSelected(item.id);this.focusOnItem(i);},onKeyPress:e=>{if(e.key===' '||e.key==='Enter'){this.props.onCharSelected(item.id);this.focusOnItem(i);}},children:[/*#__PURE__*/_jsx(\"img\",{src:item.thumbnail,alt:\"item.name\",style:imgStyle}),/*#__PURE__*/_jsx(\"div\",{className:\"char__name\",children:item.name})]},item.id);});return/*#__PURE__*/_jsx(\"ul\",{className:\"char__grid\",children:items});}render(){const{charList,error,loading,offset,newItemLoading,charEnded}=this.state;const items=this.renderItems(charList);const errorMessage=error?/*#__PURE__*/_jsx(ErrorMessage,{}):null;const spinner=loading?/*#__PURE__*/_jsx(Spinner,{}):null;const content=!(loading||error)?items:null;return/*#__PURE__*/_jsxs(\"div\",{className:\"char__list\",children:[errorMessage,spinner,content,/*#__PURE__*/_jsx(\"button\",{className:\"button button__main button__long\",disabled:newItemLoading,style:{'display':charEnded?'none':'block'},onClick:()=>this.onRequest(offset),children:/*#__PURE__*/_jsx(\"div\",{className:\"inner\",children:\"load more\"})})]});}}export default CharList;","map":{"version":3,"names":["Component","Spinner","ErrorMessage","MarvelService","jsx","_jsx","jsxs","_jsxs","CharList","constructor","arguments","state","charList","loading","error","newItemLoading","offset","charEnded","marvelService","onRequest","onCharListLoading","getAllCharacters","then","onCharListLoaded","catch","onError","setState","newcharList","ended","length","_ref","itemRefs","setRef","ref","push","focusOnItem","id","forEach","item","classList","remove","add","focus","componentDidMount","renderItems","arr","items","map","i","imgStyle","thumbnail","className","tabIndex","onClick","props","onCharSelected","onKeyPress","e","key","children","src","alt","style","name","render","errorMessage","spinner","content","disabled"],"sources":["/Users/macbook/work/Marvel-site/marvel_starter/src/components/charList/CharList.js"],"sourcesContent":["import { Component } from 'react';\nimport Spinner from '../spiner/spiner';\nimport ErrorMessage from '../errorMessage/errorMessage';\nimport MarvelService from '../../services/MarvelService';\nimport PropTypes from 'prop-types';\n\nimport './charList.scss';\n\nclass CharList extends Component {\n\n    state = {\n        charList: [],\n        loading: true,\n        error: false,\n        newItemLoading: false,\n        offset: 260,\n        charEnded: false\n    }\n\n    marvelService = new MarvelService();\n\n    componentDidMount() {\n        this.onRequest();\n    }\n\n    onRequest = (offset) => {\n        this.onCharListLoading();\n        this.marvelService.getAllCharacters(offset)\n            .then(this.onCharListLoaded)\n            .catch(this.onError);\n    }\n\n    onCharListLoading = () => {\n        this.setState({\n            newItemLoading: true\n        })\n    }\n\n    onCharListLoaded = (newcharList) => {\n        let ended = false;\n        if(newcharList.length < 9){\n            ended = true;\n        }\n\n        this.setState(({offset, charList}) => ({\n            charList: [...charList, ...newcharList],\n            loading: false,\n            newItemLoading: false,\n            offset: offset + 9,\n            charEnded: ended\n        }))\n    }\n\n    onError = () => {\n        this.setState({\n            error: true,\n            loading: false\n        })\n    }\n\n    itemRefs = [];\n\n    setRef = (ref) => {\n        this.itemRefs.push(ref);\n    }\n\n    focusOnItem = (id) => {\n        this.itemRefs.forEach(item => item.classList.remove('char__item_selected'));\n        this.itemRefs[id].classList.add('char__item_selected');\n        this.itemRefs[id].focus();\n    }\n\n    renderItems(arr) {\n        const items = arr.map((item, i) => {\n            let imgStyle = {'objectFit' : 'cover'};\n            if (item.thumbnail === 'http://i.annihil.us/u/prod/marvel/i/mg/b/40/image_not_available.jpg') {\n                imgStyle = {'objectFit' : 'unset'};\n            }\n        \n\n            return (\n                <li \n                    className=\"char__item\"\n                    tabIndex={0}\n                    ref={this.setRef}\n                    key={item.id}\n                    onClick={() => {\n                        this.props.onCharSelected(item.id);\n                        this.focusOnItem(i);\n                        }}\n                    onKeyPress = {(e) => {\n                        if(e.key === ' ' || e.key === 'Enter') {\n                            this.props.onCharSelected(item.id);\n                            this.focusOnItem(i);\n                        }\n                    }}>\n\n                        <img src={item.thumbnail} alt=\"item.name\" style={imgStyle}/>\n                        <div className=\"char__name\">{item.name}</div>\n                </li>\n            )\n        });\n\n        return (\n            <ul className=\"char__grid\">\n                {items}\n            </ul>\n        )\n    }\n\n    render () {\n        const {charList, error, loading, offset, newItemLoading, charEnded} = this.state;\n\n        const items = this.renderItems(charList);\n\n        const errorMessage = error ? <ErrorMessage/> : null;\n        const spinner = loading ? <Spinner/> : null;\n        const content = !(loading || error) ? items : null;\n\n        return (\n            <div className=\"char__list\">\n                {errorMessage}\n                {spinner}\n                {content}\n\n                <button \n                    className=\"button button__main button__long\"\n                    disabled = {newItemLoading}\n                    style={{'display' : charEnded ? 'none' : 'block'}}\n                    onClick={() => this.onRequest(offset)}>\n                    <div className=\"inner\">load more</div>\n                </button>\n            </div>\n        )\n    }\n}\n\nCharList.propTypes = {\n    onCharSelected: PropTypes.func.isRequired\n}\n\nexport default CharList;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}